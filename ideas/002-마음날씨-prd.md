# 마음날씨 (MaumNalssi) — Product Requirements Document

> **문서 버전**: 2.0
> **작성일**: 2026-01-31
> **상태**: 3단계 완료
> **대상 아이디어**: 002-마음날씨

---

## 1. Executive Summary

**마음날씨**는 한국어 감정 어휘로 매일 감정을 기록하고, 데이터 기반으로 패턴을 분석하여 맞춤형 셀프케어 행동을 제안하는 감정 관리 앱이다.

**핵심 가치 제안**: "기록하고 끝"이 아닌, "기록 → 분석 → 행동"의 완결된 감정 관리 루프를 한국어 감정 문화에 맞게 제공한다.

### 왜 지금인가
- **필코노미 트렌드** (트렌드 코리아 2026): 감정 관리가 하나의 역량이자 소비 동기로 부상
- **시장 4배 성장**: 한국 기분 기록 앱 사용자 50만(2023) → 200만(2025) (와이즈앱)
- **시장 공백**: "기록 앱"(하루콩)과 "상담 앱"(마인드카페, 트로스트) 사이, "기록+분석+행동 제안"을 통합 제공하는 앱 부재

### 핵심 수치
| 항목 | 수치 |
|------|------|
| TAM | 글로벌 Mood Tracking Apps $61억 (2025) |
| SAM | 한국 감정 관리 앱 잠재 사용자 300~500만 명 |
| SOM (1년) | MAU 3~5만 명 (보수적) |
| 목표 수익 (1년) | 월 525만 원 (유료 1,500명 × 3,500원) |
| MVP 기간 | 2~3개월 |

---

## 2. Problem Statement

### 2-1. 핵심 문제

**"감정을 기록하고 나면, 그 다음은?"**

현재 한국 시장의 감정 관리 앱은 두 극단에 위치한다:

1. **기록 앱** (하루콩, MOODA, Daylio): 감정을 기록할 수 있지만, 기록 후 "그래서 어떻게 해야 하는가?"에 대한 답이 없음
2. **상담 앱** (마인드카페, 트로스트): 전문 상담을 제공하지만, 3~10만원/회 비용 부담 + 심리적 진입 장벽

이 두 극단 사이에 있는 대다수 사용자 — "전문 상담은 부담스럽지만, 단순 기록보다 더 능동적인 관리가 필요한" 사용자층 — 을 위한 서비스가 없다.

### 2-2. 세부 문제

| 문제 | 현 상태 | 영향 |
|------|---------|------|
| 기록 후 행동 부재 | 감정 기록 앱은 기록에서 끝남 | 사용자 이탈, 기록 습관 중단 |
| 한국어 감정 어휘 미반영 | 영어권 감정 체계를 번역한 수준 | '서운하다', '답답하다', '억울하다' 등 한국어 고유 감정 표현 불가 |
| 가격 공백 | 무료(기록 앱) vs 3~10만원(상담 앱) | 중간 가격대 셀프케어 서비스 부재 |
| 패턴 인지 부재 | 감정 변화의 원인/패턴을 사용자가 직접 파악해야 함 | 반복되는 부정적 패턴에 대한 사전 대응 불가 |

*근거: 2단계 시장분석 — 한국 감정 기록 앱 사용자 4배 성장(2023→2025, 와이즈앱), AI 심리상담 이용 의향 40% (한국리서치 2025)*

### 2-3. 기회 가설

> 한국어 감정 어휘에 특화된 간편 기록 + 데이터 기반 패턴 분석 + 맞춤형 셀프케어 행동 제안을 하나의 앱에서 제공하면, 기존 기록 앱 사용자의 이탈을 줄이고 유료 전환율을 높일 수 있다.

---

## 3. Target Users & Personas

### 3-1. 주요 페르소나

#### 페르소나 A: "감정 기록 이탈자" (핵심 타겟)
- **프로필**: 25세 여성 직장인, 하루콩 6개월 사용 후 중단
- **행동**: 감정 기록은 꾸준히 했지만, "그래서 뭘 해야 하는지" 몰라서 흥미를 잃음
- **니즈**: "내 감정 패턴을 알고 싶고, 기분이 안 좋을 때 뭘 하면 좋은지 알려줬으면"
- **지불 의향**: 월 3,000~5,000원 (커피 한 잔 가격)

#### 페르소나 B: "셀프케어 입문자"
- **프로필**: 29세 남성 개발자, 번아웃 경험 후 자기 관리에 관심
- **행동**: 심리상담은 아직 부담스럽고, 혼자서 감정을 다스리고 싶음
- **니즈**: "나도 모르게 반복되는 감정 패턴을 객관적으로 보고 싶다"
- **지불 의향**: 연간 구독 가능 (효과 확인 후)

#### 페르소나 C: "감정 분석 호기심형"
- **프로필**: 22세 대학생, MBTI/심리테스트를 자주 하는 Z세대
- **행동**: 메타센싱 트렌드 — 감정도 MBTI처럼 객관적으로 분석하고 싶음
- **니즈**: "나의 감정 유형을 알고 싶고, 친구들에게 공유하고 싶다"
- **지불 의향**: 무료 사용 위주, 바이럴 기여 가치 높음

### 3-2. 타겟 규모

| 세그먼트 | 규모 | 근거 |
|---------|------|------|
| MZ세대 감정 관리 관심층 | ~800만 명 | 20~35세 인구 1,200만 × 자기관리 앱 이용률 65% |
| 감정 관리 앱 사용 경험자 | ~500만 명 | 하루콩 200만 + 마인드카페 400만 + 기타 (중복 제거) |
| AI 심리상담 이용 의향자 | ~480만 명 | 관심층 800만 × 이용 의향 40% (한국리서치 2025) |
| 핵심 타겟 (기록+분석+행동) | ~300만 명 | "기록은 하고 싶지만 상담까지는 부담" 중간층 |

---

## 4. User Stories

### 4-1. 감정 기록

| ID | As a | I want to | So that |
|----|------|-----------|---------|
| US-01 | 사용자 | 10초 이내에 오늘의 감정을 기록하고 싶다 | 매일 부담 없이 기록 습관을 유지할 수 있다 |
| US-02 | 사용자 | 한국어로 된 감정 어휘(서운함, 답답함, 뿌듯함 등)로 감정을 선택하고 싶다 | 내 감정을 더 정확하게 표현할 수 있다 |
| US-03 | 사용자 | 감정과 함께 활동 태그(출근, 회의, 운동 등)를 연결하고 싶다 | 어떤 활동이 감정에 영향을 주는지 파악할 수 있다 |

### 4-2. 패턴 분석

| ID | As a | I want to | So that |
|----|------|-----------|---------|
| US-04 | 사용자 | 주간 감정 요약 리포트를 받고 싶다 | 한 주간 내 감정 흐름을 한눈에 파악할 수 있다 |
| US-05 | 유료 사용자 | 감정-활동-시간 상관관계 분석을 보고 싶다 | "화요일 오후에 답답함이 반복된다"를 알 수 있다 |

### 4-3. 셀프케어 행동 제안

| ID | As a | I want to | So that |
|----|------|-----------|---------|
| US-06 | 사용자 | 현재 감정에 맞는 셀프케어 행동을 추천받고 싶다 | "답답할 때 뭘 하면 좋은지" 바로 실행할 수 있다 |
| US-07 | 사용자 | 셀프케어 행동에 대해 "도움됨/아님" 피드백을 남기고 싶다 | 나에게 맞는 행동이 점점 더 정확하게 추천된다 |

---

## 5. Functional Requirements

### 5-1. MVP 핵심 기능 (P0 — 필수)

#### F-01: 감정 태깅 (10초 기록)

| 항목 | 명세 |
|------|------|
| **감정 어휘** | 한국어 특화 감정 36종 (대분류 7종 → 소분류 36종) |
| **감정 분류 체계** | 대분류 7종 (기쁨, 기대/설렘, 평온, 슬픔, 분노, 불안, 무기력) → 소분류 36종 |
| **입력 방식** | 터치로 감정 태그 1~3개 선택 |
| **활동 태그** | 기본 20종 + 사용자 커스텀 |
| **메모** | 선택적 한줄 메모 (최대 200자) |
| **시간** | 기록 시점 자동 저장 + 수동 시간 변경 가능 |
| **빈도** | 하루 무제한 기록 가능 |

**수용 기준:**
- AC-01-1: 감정 태그 1~3개 선택 후 저장 시 1초 이내 응답
- AC-01-2: 활동 태그 0~N개 선택 가능
- AC-01-3: 메모 200자 초과 시 입력 차단
- AC-01-4: recorded_at 기본값은 현재 시각, 수동 변경 가능

#### F-02: 감정 캘린더 & 기본 통계

| 항목 | 명세 |
|------|------|
| **캘린더 뷰** | 월별 캘린더에 일별 주요 감정 표시 (색상/아이콘) |
| **주간 요약** | 이번 주 감정 빈도 Top 3, 긍정/부정 비율, 활동 태그 Top 3 |
| **감정 히스토리** | 일별 감정 기록 리스트 (타임라인 뷰) |

**수용 기준:**
- AC-02-1: 캘린더에서 날짜별 주요 감정 아이콘/색상 표시
- AC-02-2: 주간 요약에 감정 빈도 Top 3, 긍정/부정 비율, 활동 Top 3 포함
- AC-02-3: 특정 날짜 탭 시 해당일 기록 리스트 표시

#### F-03: 셀프케어 행동 카드

| 항목 | 명세 |
|------|------|
| **카드 구성** | 감정별 3~5개 행동 제안 (100개+ 행동 카드) |
| **매핑 방식** | 규칙 기반 (감정 태그 → 행동 카드 매핑 테이블) |
| **무료 제한** | 일 3개 카드 |
| **피드백** | "도움됨" / "도움 안 됨" 버튼 → 개인화 점수 축적 |

**수용 기준:**
- AC-03-1: 감정 기록 저장 후 해당 감정에 매핑된 셀프케어 카드 표시
- AC-03-2: 무료 사용자는 일 3개, 프리미엄은 무제한
- AC-03-3: 피드백 버튼 탭 시 피드백 저장, 이후 추천 시 피드백 반영 정렬

#### F-04: 사용자 인증 & 프로필

| 항목 | 명세 |
|------|------|
| **인증 방식** | 카카오 로그인, Apple 로그인, 이메일/비밀번호 |
| **프로필** | 닉네임, 연령대(선택), 알림 시간 설정 |
| **온보딩** | 3스텝: 감정 체계 안내 → 첫 감정 기록 → 알림 시간 설정 |

**수용 기준:**
- AC-04-1: 카카오/Apple/이메일 중 하나로 회원가입/로그인 가능
- AC-04-2: 프로필에 닉네임(필수), 연령대(선택), 알림시간(기본 21:00) 저장

#### F-05: 푸시 알림

| 항목 | 명세 |
|------|------|
| **기록 리마인더** | 사용자가 설정한 시간에 기록 알림 (기본: 오후 9시) |
| **주간 리포트** | 매주 월요일 오전, 지난 주 감정 요약 알림 |
| **기술** | Expo Push Notifications |

**수용 기준:**
- AC-05-1: 설정 시간에 푸시 알림 수신
- AC-05-2: 주간 리포트 생성 시 알림

### 5-2. 유료 기능 (P0 — 필수, 수익화)

#### F-06: AI 감정 패턴 리포트 (프리미엄)

| 항목 | 명세 |
|------|------|
| **주간 리포트** | 감정-시간대-요일 분석, 가장 빈번한 감정 패턴, 핵심 인사이트 문구 |
| **월간 리포트** | 월별 감정 추이, 긍정/부정 비율 변화, 활동-감정 상관관계 Top 5 |
| **인사이트 예시** | "화요일 오후에 '답답함'이 집중됩니다", "운동한 날은 긍정 감정이 2배 높습니다" |
| **구현 방식** | PostgreSQL 집계 함수 + Edge Functions (AI/ML 불필요) |

**수용 기준:**
- AC-06-1: 프리미엄 사용자에게만 상세 리포트 반환
- AC-06-2: 주간 리포트에 요일별/시간대별 감정 패턴, 인사이트 문구 포함
- AC-06-3: 월간 리포트에 감정 추이, 활동-감정 상관관계 포함

#### F-07: 무제한 셀프케어 카드 (프리미엄)

| 항목 | 명세 |
|------|------|
| **무제한 카드** | 무료 3개/일 제한 해제 |
| **개인화 랭킹** | 피드백 데이터 기반 "나에게 효과적이었던 행동" 우선 표시 |

**수용 기준:**
- AC-07-1: 프리미엄 사용자에게 카드 수 제한 없이 반환

#### F-08: 데이터 내보내기 (프리미엄)

| 항목 | 명세 |
|------|------|
| **PDF 리포트** | 월간/분기별 감정 분석 리포트 PDF 생성 |
| **CSV 내보내기** | 전체 감정 기록 데이터 CSV 다운로드 |

**수용 기준:**
- AC-08-1: PDF 생성 시 월간/분기 감정 분석 포함
- AC-08-2: CSV에 전체 감정 기록 포함

### 5-3. 구독 & 결제 (P0 — 필수)

#### F-09: 인앱 결제

| 항목 | 명세 |
|------|------|
| **구독 플랜** | 월간 3,500원 / 연간 27,900원 (33% 할인) |
| **무료 체험** | 프리미엄 7일 무료 체험 (가입 후 1회) |
| **결제 수단** | Apple IAP, Google Play Billing |
| **기술** | RevenueCat SDK 연동 |

**수용 기준:**
- AC-09-1: 구독 구매 후 is_premium 즉시 반영
- AC-09-2: 만료 시 프리미엄 기능 차단

### 5-4. 바이럴 기능 (P1 — 출시 후 우선)

#### F-10: 감정 리포트 공유 카드

| 항목 | 명세 |
|------|------|
| **공유 카드** | "이번 주 나의 감정 리포트" 카드 이미지 생성 |
| **디자인** | 날씨 메타포 기반 (맑음, 구름, 비, 폭풍 등) |
| **공유 채널** | 카카오톡, 인스타그램 스토리, 이미지 저장 |

### 5-5. 향후 확장 기능 (P2 — MVP 이후)

| ID | 기능 | 설명 | 예상 시기 |
|----|------|------|----------|
| F-11 | LLM 개인화 인사이트 | OpenAI API로 인사이트 문구 개인화 생성 | MVP+2개월 |
| F-12 | 예측적 알림 | "내일 월요일, 지난 4주간 월요일 아침 스트레스가 높았습니다" | MVP+3개월 |
| F-13 | 감정 유형 분석 | MBTI처럼 "나의 감정 유형" 분류 → 공유 가능 | MVP+2개월 |
| F-14 | 위젯 | 홈 화면 감정 기록 위젯 | MVP+1개월 |
| F-15 | 상담 연결 | 전문 상담이 필요한 경우 외부 서비스 연결 | MVP+6개월 |

---

## 6. Non-Functional Requirements

### 6-1. 성능

| 항목 | 기준 |
|------|------|
| 앱 실행 시간 | 콜드 스타트 2초 이내 |
| 감정 기록 저장 | 1초 이내 응답 |
| 리포트 생성 | 3초 이내 (캐싱 적용) |
| API 응답 시간 | 500ms 이내 (95 percentile) |

### 6-2. 보안 & 개인정보

| 항목 | 기준 |
|------|------|
| 데이터 전송 | HTTPS (TLS 1.3) |
| 데이터 저장 | Supabase RLS (Row Level Security)로 사용자별 격리 |
| 인증 | Supabase Auth (JWT 토큰) |
| 개인정보 처리 | 개인정보 처리방침 고지, 최소한의 개인정보 수집 |
| 데이터 삭제 | 계정 삭제 시 모든 데이터 영구 삭제 (30일 유예) |
| 앱 잠금 | 생체인식 / PIN 잠금 지원 |

### 6-3. 접근성

| 항목 | 기준 |
|------|------|
| 최소 OS | iOS 15+, Android 10+ |
| 다크 모드 | 지원 |
| 폰트 크기 | 시스템 설정 연동 |
| VoiceOver/TalkBack | 주요 화면 접근성 레이블 |

### 6-4. 확장성

| 항목 | 기준 |
|------|------|
| 동시 사용자 | Supabase Free Tier → Pro 전환 시 10만+ 지원 |
| 데이터 증가 | 인덱스 최적화 + 소프트 삭제 기반 설계 |
| API Rate Limit | 사용자당 100 req/min |

---

## 7. Technical Architecture

> **작성 방법**: `sc:design` 스킬을 통해 Functional Requirements(P0/P1), Non-functional Requirements, 기술 설계 제약을 입력으로 설계하였다.

### 7-1. 기술 스택

| 계층 | 기술 | 선택 이유 |
|------|------|----------|
| **프론트엔드** | React Native + TypeScript + Expo | 크로스 플랫폼, 1인 개발 효율, OTA 업데이트 |
| **UI 프레임워크** | React Native Paper / NativeWind | Material Design 준수, 빠른 개발 |
| **상태 관리** | Zustand + TanStack Query | 경량 전역 상태 + 서버 상태 캐싱/동기화 |
| **로컬 저장소** | WatermelonDB (구조화 데이터) + MMKV (KV) | 오프라인 우선, Observable 지원, 초고속 KV |
| **차트/그래프** | Victory Native | 감정 통계 시각화 |
| **캘린더** | react-native-calendars | 감정 캘린더 뷰 |
| **백엔드** | Supabase (PostgreSQL + Auth + Edge Functions + Storage) | BaaS, 1인 개발에 최적, RLS 내장 |
| **결제** | RevenueCat | 크로스 플랫폼 IAP 통합 관리 |
| **푸시 알림** | Expo Push Notifications | Expo 생태계 연동 |
| **빌드/배포** | Expo Application Services (EAS) | OTA 업데이트, 빌드 자동화 |
| **분석** | PostHog | 사용자 행동 분석, 퍼널 분석 |
| **크래시 리포트** | Sentry | 에러 모니터링 |

### 7-2. 시스템 구조도

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Client (React Native + Expo)                     │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        UI Layer (Screens)                       │   │
│  │  ┌────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐ ┌─────────┐ │   │
│  │  │ 감정   │ │ 캘린더/  │ │ 셀프케어 │ │ 리포트 │ │ 설정/   │ │   │
│  │  │ 기록   │ │ 히스토리 │ │ 카드     │ │        │ │ 프로필  │ │   │
│  │  └───┬────┘ └────┬─────┘ └────┬─────┘ └───┬────┘ └────┬────┘ │   │
│  └──────┼───────────┼────────────┼────────────┼───────────┼──────┘   │
│         └───────────┴────────────┴────────────┴───────────┘          │
│                                  │                                    │
│  ┌───────────────────────────────┴──────────────────────────────┐    │
│  │              State Management (Zustand + TanStack Query)      │    │
│  │   ┌────────────────┐  ┌──────────────┐  ┌────────────────┐  │    │
│  │   │ Auth Store      │  │ Emotion      │  │ Subscription   │  │    │
│  │   │ (인증 상태)     │  │ Record Store │  │ Store          │  │    │
│  │   └────────────────┘  └──────────────┘  └────────────────┘  │    │
│  └───────────────────────────────┬──────────────────────────────┘    │
│                                  │                                    │
│  ┌───────────────────────────────┴──────────────────────────────┐    │
│  │              Offline-First Layer (오프라인 우선 계층)           │    │
│  │   ┌──────────────┐  ┌──────────────┐  ┌───────────────────┐  │    │
│  │   │ WatermelonDB │  │ MMKV         │  │ Sync Queue       │  │    │
│  │   │ (감정 기록,  │  │ (설정, 캐시, │  │ (오프라인 기록   │  │    │
│  │   │  피드백 등   │  │  토큰, 구독  │  │  대기열 관리)    │  │    │
│  │   │  구조화 데이터)│  │  상태 등 KV) │  │                  │  │    │
│  │   └──────────────┘  └──────────────┘  └───────────────────┘  │    │
│  └──────────────────────────────────────────────────────────────┘    │
│                                  │                                    │
│  ┌───────────────────────────────┴──────────────────────────────┐    │
│  │              Network Layer (네트워크 계층)                     │    │
│  │   ┌──────────────────┐  ┌──────────────────────────────┐    │    │
│  │   │ Supabase JS SDK  │  │ RevenueCat SDK               │    │    │
│  │   │ (Auth, REST,     │  │ (인앱결제, 구독 상태)         │    │    │
│  │   │  Edge Functions) │  │                               │    │    │
│  │   └────────┬─────────┘  └──────────────┬───────────────┘    │    │
│  └────────────┼────────────────────────────┼───────────────────┘    │
└───────────────┼────────────────────────────┼────────────────────────┘
                │ HTTPS (TLS 1.3)            │ HTTPS
                ▼                            ▼
┌───────────────────────────────────────┐  ┌─────────────────────────┐
│          Supabase Backend             │  │     RevenueCat          │
│                                       │  │  구독 관리 + Webhook    │
│  ┌──────────┐  ┌──────────────────┐  │  └─────────────────────────┘
│  │ Auth     │  │ PostgreSQL       │  │
│  │ 카카오/  │  │ 감정 기록, 사용자│  │  ┌─────────────────────────┐
│  │ Apple/   │  │ 셀프케어, 피드백 │  │  │     Expo Push           │
│  │ Email    │  │ 구독, 리포트 캐시│  │  │  기록 리마인더/리포트   │
│  └──────────┘  └──────────────────┘  │  └─────────────────────────┘
│  ┌──────────┐  ┌──────────────────┐  │
│  │ Storage  │  │ Edge Functions   │  │  ┌─────────────────────────┐
│  │ PDF/이미지│  │ 리포트, 추천,   │  │  │  PostHog + Sentry       │
│  └──────────┘  │ PDF/CSV, 구독   │  │  │  분석 + 에러 모니터링   │
│                │ 검증, 푸시 발송  │  │  └─────────────────────────┘
│  ┌──────────┐  └──────────────────┘  │
│  │ RLS      │  ┌──────────────────┐  │
│  │ 사용자별 │  │ pg_cron          │  │
│  │ 데이터격리│  │ 스케줄 작업      │  │
│  └──────────┘  └──────────────────┘  │
└───────────────────────────────────────┘
```

### 7-3. 오프라인 우선 아키텍처

```
[사용자: 감정 기록 저장]
    │
    ▼
┌──────────────────┐
│ WatermelonDB     │ ← 1. 즉시 로컬 저장 (0~50ms)
│ sync_status =    │    client_created_at = 현재시간
│ 'pending'        │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ UI 즉시 반영     │ ← 2. 낙관적 업데이트 (Optimistic UI)
│ "저장 완료"      │    오프라인 시 "(오프라인 저장됨)" 표시
└────────┬─────────┘
         │
         ▼
┌──────────────────┐     ┌──────────────────────┐
│ Sync Queue       │────→│ 네트워크 상태 감지    │
│ (동기화 대기열)   │     │ (NetInfo API)        │
│ 최대 3회 재시도   │     │                      │
│ 지수 백오프       │     │ 온라인 → 즉시 동기화 │
│ (1s→2s→4s)       │     │ 오프라인 → 대기      │
└──────────────────┘     │ 복구 시 → 배치 동기화│
                         └──────────┬───────────┘
                                    │
                                    ▼
                         ┌──────────────────────┐
                         │ Supabase 서버 동기화  │
                         │                      │
                         │ Push: 로컬 → 서버    │
                         │ Pull: 서버 → 로컬    │
                         │                      │
                         │ 충돌 해결:           │
                         │ Server Wins 원칙     │
                         │ 단, 미동기화 로컬    │
                         │ 레코드는 항상 보존   │
                         └──────────────────────┘
```

**저장소 역할 분담:**
- **WatermelonDB (SQLite 기반)**: `emotion_records`, `emotion_record_emotions`, `emotion_record_activities`, `selfcare_feedback`, `daily_card_usage` — 관계형 쿼리, 동기화 내장, Observable 지원
- **MMKV (Key-Value)**: JWT 토큰, 사용자 설정, 구독 상태 캐시, 마스터 데이터 버전, 마지막 동기화 시점, 앱 잠금 설정 — 초고속 읽기/쓰기, 동기식 접근

**충돌 해결 원칙**: "사용자의 감정 기록은 절대 유실하지 않는다"
- CREATE: UUID 기반이므로 충돌 없음, 서버에 INSERT
- UPDATE: `server_updated_at` vs `client_updated_at` 비교, 서버 타임스탬프 우선
- DELETE: 소프트 삭제 (`deleted_at`) 사용, 양측 삭제 상태 병합

### 7-4. 핵심 설계 원칙

1. **오프라인 우선**: 감정 기록은 WatermelonDB에 즉시 저장 → 네트워크 복구 시 동기화
2. **최소 외부 의존**: MVP에서 AI/ML 모델 불필요, SQL 집계로 패턴 분석
3. **점진적 복잡성**: 규칙 기반 → 통계 기반 → (향후) LLM 기반으로 단계적 고도화
4. **RLS 기반 보안**: 모든 테이블에 Row Level Security 적용
5. **낙관적 UI**: 저장/수정 시 로컬 상태를 즉시 반영하여 체감 속도 최적화

### 7-5. DB 스키마

#### ERD 개요

```
users ──< emotion_records ──< emotion_record_emotions >── emotions ──< emotion_categories
  │            │
  │            └──< emotion_record_activities >── activities
  │
  ├──< push_tokens
  ├──< selfcare_feedback
  ├──< daily_card_usage
  ├──< subscriptions
  └──< report_cache

emotions ──< selfcare_emotion_map >── selfcare_cards
```

#### 테이블 정의

##### `users` (사용자)
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE,
  nickname TEXT NOT NULL,
  age_group TEXT CHECK (age_group IN ('10s', '20s', '30s', '40s', '50s+')),
  notification_time TIME DEFAULT '21:00',
  notification_enabled BOOLEAN DEFAULT TRUE,
  weekly_report_enabled BOOLEAN DEFAULT TRUE,
  timezone TEXT DEFAULT 'Asia/Seoul',
  is_premium BOOLEAN DEFAULT FALSE,
  premium_expires_at TIMESTAMPTZ,
  onboarding_completed BOOLEAN DEFAULT FALSE,
  app_lock_enabled BOOLEAN DEFAULT FALSE,
  app_lock_type TEXT CHECK (app_lock_type IN ('biometric', 'pin', NULL)),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
-- RLS: 사용자는 자신의 행만 SELECT/UPDATE 가능
-- 인덱스: PK (id), UNIQUE (email)
```

##### `emotion_categories` (감정 대분류 — 7종)
```sql
CREATE TABLE emotion_categories (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL UNIQUE,       -- '기쁨', '기대/설렘', '평온', '슬픔', '분노', '불안', '무기력'
  color TEXT NOT NULL,             -- '#FFD700'
  icon TEXT NOT NULL,              -- 'sunny', 'rainbow' 등
  weather_label TEXT NOT NULL,     -- '맑음', '무지개' 등
  valence TEXT NOT NULL CHECK (valence IN ('positive', 'negative', 'neutral')),
  sort_order INT DEFAULT 0
);
-- RLS: 모든 인증 사용자 읽기 가능 (마스터 데이터)
```

##### `emotions` (감정 소분류 — 한국어 어휘 36종)
```sql
CREATE TABLE emotions (
  id SERIAL PRIMARY KEY,
  category_id INT NOT NULL REFERENCES emotion_categories(id),
  name TEXT NOT NULL UNIQUE,       -- '서운함', '답답함', '억울함', '뿌듯함', '설렘' 등
  description TEXT,                -- 감정 설명 (온보딩/툴팁용)
  intensity INT DEFAULT 3 CHECK (intensity BETWEEN 1 AND 5),
  color TEXT,
  sort_order INT DEFAULT 0
);
-- RLS: 모든 인증 사용자 읽기 가능 (마스터 데이터)
-- 인덱스: idx_emotions_category (category_id)
```

##### `activities` (활동 태그)
```sql
CREATE TABLE activities (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,              -- '출근', '회의', '운동' 등
  icon TEXT NOT NULL,
  is_default BOOLEAN DEFAULT TRUE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  sort_order INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  CONSTRAINT activity_default_check CHECK (
    (is_default = TRUE AND user_id IS NULL) OR
    (is_default = FALSE AND user_id IS NOT NULL)
  )
);
-- RLS: 기본 활동 모두 읽기, 커스텀은 본인만 CRUD
-- 인덱스: idx_activities_user (user_id) WHERE user_id IS NOT NULL
```

##### `emotion_records` (감정 기록 — 핵심 테이블)
```sql
CREATE TABLE emotion_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  memo TEXT,
  recorded_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  client_created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  sync_status TEXT DEFAULT 'synced' CHECK (sync_status IN ('synced', 'pending', 'conflict')),
  deleted_at TIMESTAMPTZ,          -- 소프트 삭제
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  CONSTRAINT memo_max_length CHECK (char_length(memo) <= 200)
);
-- RLS: 사용자는 자신의 기록만 CRUD
-- 인덱스: idx_emotion_records_user_date (user_id, recorded_at DESC) WHERE deleted_at IS NULL
-- 인덱스: idx_emotion_records_user_period (user_id, recorded_at) WHERE deleted_at IS NULL
```

##### `emotion_record_emotions` (기록-감정 연결, M:N)
```sql
CREATE TABLE emotion_record_emotions (
  record_id UUID NOT NULL REFERENCES emotion_records(id) ON DELETE CASCADE,
  emotion_id INT NOT NULL REFERENCES emotions(id),
  PRIMARY KEY (record_id, emotion_id)
);
-- RLS: emotion_records를 통해 간접 보호 (EXISTS 서브쿼리)
-- 인덱스: idx_ere_emotion (emotion_id)
```

##### `emotion_record_activities` (기록-활동 연결, M:N)
```sql
CREATE TABLE emotion_record_activities (
  record_id UUID NOT NULL REFERENCES emotion_records(id) ON DELETE CASCADE,
  activity_id INT NOT NULL REFERENCES activities(id),
  PRIMARY KEY (record_id, activity_id)
);
-- RLS: emotion_records를 통해 간접 보호
-- 인덱스: idx_era_activity (activity_id)
```

##### `selfcare_cards` (셀프케어 행동 카드 — 100개+)
```sql
CREATE TABLE selfcare_cards (
  id SERIAL PRIMARY KEY,
  title TEXT NOT NULL,             -- '5분 호흡법', '짧은 산책'
  description TEXT NOT NULL,
  duration_minutes INT,
  category TEXT NOT NULL CHECK (category IN (
    'breathing', 'movement', 'sensory', 'social', 'creative'
  )),
  icon TEXT NOT NULL,
  is_active BOOLEAN DEFAULT TRUE,
  sort_order INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
-- RLS: 모든 인증 사용자 읽기 가능 (마스터 데이터)
-- 인덱스: idx_selfcare_cards_category (category) WHERE is_active = TRUE
```

##### `selfcare_emotion_map` (감정-셀프케어 매핑)
```sql
CREATE TABLE selfcare_emotion_map (
  emotion_id INT NOT NULL REFERENCES emotions(id),
  card_id INT NOT NULL REFERENCES selfcare_cards(id),
  relevance_score FLOAT DEFAULT 1.0 CHECK (relevance_score BETWEEN 0.0 AND 1.0),
  PRIMARY KEY (emotion_id, card_id)
);
-- RLS: 모든 인증 사용자 읽기 가능 (마스터 데이터)
```

##### `selfcare_feedback` (셀프케어 피드백)
```sql
CREATE TABLE selfcare_feedback (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  card_id INT NOT NULL REFERENCES selfcare_cards(id),
  emotion_id INT NOT NULL REFERENCES emotions(id),
  record_id UUID REFERENCES emotion_records(id) ON DELETE SET NULL,
  is_helpful BOOLEAN NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
-- RLS: 사용자는 자신의 피드백만 CRUD
-- 인덱스: idx_selfcare_feedback_personalization (user_id, card_id, emotion_id)
-- 인덱스: idx_selfcare_feedback_user (user_id, created_at DESC)
```

##### `subscriptions` (구독 정보)
```sql
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  plan_type TEXT NOT NULL CHECK (plan_type IN ('monthly', 'yearly')),
  status TEXT NOT NULL DEFAULT 'active' CHECK (status IN (
    'active', 'trialing', 'cancelled', 'expired', 'grace_period'
  )),
  revenue_cat_id TEXT UNIQUE,
  original_purchase_date TIMESTAMPTZ,
  started_at TIMESTAMPTZ NOT NULL,
  expires_at TIMESTAMPTZ NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
-- RLS: 사용자는 자신의 구독만 SELECT, INSERT/UPDATE는 Edge Function(service_role)만
-- 인덱스: idx_subscriptions_user_status (user_id, status)
-- 인덱스: idx_subscriptions_expiry (expires_at) WHERE status IN ('active', 'trialing', 'grace_period')
```

##### `push_tokens` (푸시 알림 토큰)
```sql
CREATE TABLE push_tokens (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  token TEXT NOT NULL UNIQUE,      -- ExponentPushToken[...]
  platform TEXT NOT NULL CHECK (platform IN ('ios', 'android')),
  device_id TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
-- RLS: 사용자는 자신의 토큰만 CRUD
-- 인덱스: idx_push_tokens_user (user_id) WHERE is_active = TRUE
```

##### `daily_card_usage` (일일 셀프케어 카드 사용량 추적)
```sql
CREATE TABLE daily_card_usage (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  usage_date DATE NOT NULL DEFAULT CURRENT_DATE,
  card_count INT NOT NULL DEFAULT 0,
  last_card_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  CONSTRAINT unique_user_date UNIQUE (user_id, usage_date),
  CONSTRAINT card_count_positive CHECK (card_count >= 0)
);
-- RLS: 사용자는 자신의 사용량만 SELECT/INSERT/UPDATE
```

##### `report_cache` (리포트 캐시)
```sql
CREATE TABLE report_cache (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  report_type TEXT NOT NULL CHECK (report_type IN ('weekly', 'monthly')),
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  report_data JSONB NOT NULL,
  generated_at TIMESTAMPTZ DEFAULT NOW(),
  CONSTRAINT unique_user_report_period UNIQUE (user_id, report_type, period_start)
);
-- RLS: 사용자 SELECT만, INSERT/UPDATE는 Edge Function(service_role)만
-- 인덱스: idx_report_cache_user (user_id, report_type, period_start DESC)
```

#### RLS 정책 요약

| 테이블 | SELECT | INSERT | UPDATE | DELETE |
|--------|--------|--------|--------|--------|
| `users` | 본인만 | Auth 자동 | 본인만 | Edge Function |
| `emotion_categories` | 인증 사용자 전체 | - | - | - |
| `emotions` | 인증 사용자 전체 | - | - | - |
| `activities` | 기본 전체 + 본인 커스텀 | 본인 커스텀만 | 본인 커스텀만 | 본인 커스텀만 |
| `emotion_records` | 본인만 | 본인만 | 본인만 | 본인만 |
| `emotion_record_emotions` | 부모 레코드 소유자 | 부모 레코드 소유자 | - | CASCADE |
| `emotion_record_activities` | 부모 레코드 소유자 | 부모 레코드 소유자 | - | CASCADE |
| `selfcare_cards` | 인증 사용자 전체 | - | - | - |
| `selfcare_emotion_map` | 인증 사용자 전체 | - | - | - |
| `selfcare_feedback` | 본인만 | 본인만 | - | - |
| `subscriptions` | 본인만 | Edge Function | Edge Function | - |
| `push_tokens` | 본인만 | 본인만 | 본인만 | 본인만 |
| `daily_card_usage` | 본인만 | 본인만 | 본인만 | - |
| `report_cache` | 본인만 | Edge Function | Edge Function | - |

#### 핵심 DB Functions (RPC)

##### `create_emotion_record` — 감정 기록 트랜잭션 생성
```sql
CREATE OR REPLACE FUNCTION create_emotion_record(
  p_memo TEXT DEFAULT NULL,
  p_recorded_at TIMESTAMPTZ DEFAULT NOW(),
  p_emotion_ids INT[] DEFAULT '{}',
  p_activity_ids INT[] DEFAULT '{}'
)
RETURNS UUID AS $$
-- 1. emotion_records INSERT
-- 2. emotion_record_emotions INSERT (배열 순회)
-- 3. emotion_record_activities INSERT (배열 순회)
-- 하나의 트랜잭션으로 데이터 정합성 보장
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

##### `get_weekly_summary` — 주간 기본 요약 (무료)
```sql
CREATE OR REPLACE FUNCTION get_weekly_summary(
  p_start_date DATE,
  p_end_date DATE
)
RETURNS JSONB AS $$
-- 감정 빈도 Top 5, 긍정 비율, 활동 Top 3, 기록 수 반환
-- auth.uid() 기반 자동 필터링
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### 7-6. API 설계

#### Supabase REST vs Edge Function 선택 기준

| 기준 | REST API 사용 | Edge Function 사용 |
|------|-------------|-------------------|
| 단순 CRUD | O | - |
| 트랜잭션 필요 | DB Function (RPC) | - |
| 복합 비즈니스 로직 | - | O |
| 외부 API 호출 | - | O (RevenueCat, Expo Push) |
| 구독 상태 검증 필요 | - | O |
| 파일 생성 (PDF/이미지) | - | O |

#### 인증 API

| Method | 경로 | 설명 | 인증 |
|--------|------|------|------|
| - | `supabase.auth.signUp()` | 이메일 회원가입 | 불필요 |
| - | `supabase.auth.signInWithPassword()` | 이메일 로그인 | 불필요 |
| - | `supabase.auth.signInWithOAuth({ provider: 'kakao' })` | 카카오 로그인 | 불필요 |
| - | `supabase.auth.signInWithIdToken({ provider: 'apple' })` | Apple 로그인 | 불필요 |
| - | `supabase.auth.signOut()` | 로그아웃 | 필수 |
| POST | `/functions/v1/delete-account` | 계정 삭제 | 필수 |

> 계정 삭제를 Edge Function으로 분리한 이유: 모든 관련 데이터의 영구 삭제를 service_role로 트랜잭션 처리 + RevenueCat 구독 취소

#### 감정 기록 API

| Method | 경로 | 설명 | 구현 |
|--------|------|------|------|
| POST | `/rest/v1/rpc/create_emotion_record` | 감정 기록 생성 | DB Function (RPC) — 트랜잭션 |
| GET | `/rest/v1/emotion_records?select=*,...&recorded_at=gte.{start}&recorded_at=lt.{end}&deleted_at=is.null` | 기간별 기록 조회 (중첩 조인) | REST API |
| PATCH | `/rest/v1/emotion_records?id=eq.{id}` | 기록 수정 | REST API |
| PATCH | `/rest/v1/emotion_records?id=eq.{id}` + `{deleted_at: now()}` | 기록 삭제 (소프트) | REST API |

```typescript
// 감정 기록 생성 RPC
interface CreateEmotionRecordRequest {
  p_memo?: string;                // 최대 200자
  p_recorded_at?: string;         // ISO 8601
  p_emotion_ids: number[];        // 1~3개
  p_activity_ids?: number[];      // 0~N개
}
```

#### 마스터 데이터 API

| Method | 경로 | 설명 | 구현 |
|--------|------|------|------|
| GET | `/rest/v1/emotion_categories?select=*,emotions(*)&order=sort_order` | 감정 분류 체계 | REST API |
| GET | `/rest/v1/activities?or=(is_default.eq.true,user_id.eq.{uid})` | 활동 태그 (기본+커스텀) | REST API |
| POST | `/rest/v1/activities` | 커스텀 활동 태그 생성 | REST API |
| GET | `/rest/v1/selfcare_cards?is_active=eq.true` | 셀프케어 카드 목록 | REST API |

#### 셀프케어 API

| Method | 경로 | 설명 | 구현 |
|--------|------|------|------|
| POST | `/functions/v1/recommend-selfcare` | 감정 기반 셀프케어 추천 | Edge Function |
| POST | `/rest/v1/selfcare_feedback` | 피드백 제출 | REST API |

```typescript
// 셀프케어 추천 응답
interface RecommendSelfcareResponse {
  cards: {
    id: number;
    title: string;
    description: string;
    duration_minutes: number | null;
    category: string;
    personal_score: number;       // 0~1
    helpful_rate: number | null;  // 피드백 기반
  }[];
  is_premium: boolean;
  daily_usage: {
    used: number;
    limit: number;                // 무료: 3, 유료: -1(무제한)
    remaining: number;
  };
}
```

**추천 알고리즘**:
1. `selfcare_emotion_map`에서 해당 감정의 카드를 `relevance_score` 순으로 조회
2. `selfcare_feedback`에서 사용자 피드백으로 `helpful_rate` 계산
3. `personal_score = relevance_score * 0.4 + helpful_rate * 0.6` (피드백 없으면 `relevance_score` 사용)
4. `daily_card_usage` 확인 → 무료 사용자는 상위 3개만 반환
5. `daily_card_usage` 카운터 증가

#### 리포트 API

| Method | 경로 | 설명 | 구현 |
|--------|------|------|------|
| GET | `/rest/v1/rpc/get_weekly_summary` | 주간 기본 요약 (무료) | DB Function (RPC) |
| GET | `/functions/v1/weekly-report` | 주간 상세 패턴 리포트 (프리미엄) | Edge Function |
| GET | `/functions/v1/monthly-report` | 월간 상세 패턴 리포트 (프리미엄) | Edge Function |
| POST | `/functions/v1/share-card` | 공유 카드 이미지 생성 | Edge Function |

```typescript
// 주간 상세 리포트 (프리미엄)
interface WeeklyReport {
  period: { start: string; end: string };
  summary: {
    total_records: number;
    recording_days: number;
    top_emotions: { name: string; category: string; count: number; percentage: number }[];
    positive_ratio: number;
    negative_ratio: number;
  };
  patterns: {
    day_of_week: { day: string; dominant_emotion: string; record_count: number }[];
    time_of_day: { period: string; dominant_emotion: string; record_count: number }[];
    activity_correlation: { activity: string; positive_rate: number }[];
  };
  insights: string[];  // "화요일 오후에 '답답함'이 집중됩니다" 등
  comparison: { vs_last_week: { positive_change: number } };
}
```

#### 결제/구독 API

| Method | 경로 | 설명 | 구현 |
|--------|------|------|------|
| POST | `/functions/v1/verify-subscription` | 구독 상태 검증 | Edge Function |
| POST | `/functions/v1/webhook/revenuecat` | RevenueCat Webhook | Edge Function |

#### 내보내기 API

| Method | 경로 | 설명 | 구현 |
|--------|------|------|------|
| POST | `/functions/v1/export-pdf` | PDF 리포트 생성 (프리미엄) | Edge Function |
| POST | `/functions/v1/export-csv` | CSV 다운로드 (프리미엄) | Edge Function |

#### 푸시 알림 API

| Method | 경로 | 설명 | 구현 |
|--------|------|------|------|
| POST | `/rest/v1/push_tokens` | 토큰 등록 | REST API |
| DELETE | `/rest/v1/push_tokens?token=eq.{token}` | 토큰 비활성화 | REST API |
| - | pg_cron → Edge Function | 기록 리마인더 (매 정시) | 스케줄 |
| - | pg_cron → Edge Function | 주간 리포트 알림 (월 09:00 KST) | 스케줄 |

#### 사용자 프로필 API

| Method | 경로 | 설명 | 구현 |
|--------|------|------|------|
| GET | `/rest/v1/users?id=eq.{uid}` | 프로필 조회 | REST API |
| PATCH | `/rest/v1/users?id=eq.{uid}` | 프로필 수정 | REST API |
| POST | `/functions/v1/complete-onboarding` | 온보딩 완료 | Edge Function |

### 7-7. 기능-테이블-API 매핑표

| 기능 ID | 기능명 | 관련 테이블 | API 엔드포인트 | 비고 |
|---------|--------|-----------|---------------|------|
| **F-01** | 감정 태깅 (10초 기록) | `emotion_records`, `emotion_record_emotions`, `emotion_record_activities`, `emotions`, `activities` | `POST /rpc/create_emotion_record` (생성), `GET /emotion_records?...` (조회), `PATCH /emotion_records?id=eq.{id}` (수정/삭제) | RPC로 트랜잭션 처리. WatermelonDB 오프라인 우선 저장. |
| **F-02** | 감정 캘린더 & 기본 통계 | `emotion_records`, `emotion_record_emotions`, `emotion_record_activities`, `emotions`, `emotion_categories`, `activities` | `GET /emotion_records?...` (캘린더/타임라인), `GET /rpc/get_weekly_summary` (주간 요약) | 캘린더: 월별 기록 일괄 조회. 주간 요약: DB Function 서버 집계. |
| **F-03** | 셀프케어 행동 카드 | `selfcare_cards`, `selfcare_emotion_map`, `selfcare_feedback`, `daily_card_usage` | `POST /functions/v1/recommend-selfcare` (추천), `POST /selfcare_feedback` (피드백), `GET /selfcare_cards` (목록) | Edge Function에서 매핑+개인화+무료 사용량 체크. `daily_card_usage`로 3개/일 제한. |
| **F-04** | 사용자 인증 & 프로필 | `users`, `push_tokens` | `supabase.auth.*` (인증 SDK), `POST /functions/v1/complete-onboarding`, `PATCH /users?id=eq.{uid}`, `POST /functions/v1/delete-account` | 카카오/Apple/이메일은 Supabase Auth SDK. 온보딩/삭제는 Edge Function 트랜잭션. |
| **F-05** | 푸시 알림 | `push_tokens`, `users` | `POST /push_tokens` (토큰 등록), `DELETE /push_tokens?token=eq.{token}`, pg_cron → Edge Function (스케줄 발송) | 리마인더: 매 정시 해당 사용자에게 Expo Push. 주간 리포트: 매주 월요일 09:00 KST. |
| **F-06** | AI 감정 패턴 리포트 | `emotion_records`, `emotion_record_emotions`, `emotion_record_activities`, `emotions`, `emotion_categories`, `activities`, `report_cache` | `GET /functions/v1/weekly-report`, `GET /functions/v1/monthly-report` | Edge Function에서 구독 확인 → SQL 집계 → 인사이트 템플릿 생성 → `report_cache` 캐싱. |
| **F-07** | 무제한 셀프케어 카드 | `daily_card_usage`, `subscriptions` | `POST /functions/v1/recommend-selfcare` (동일 엔드포인트) | F-03과 동일 API. `is_premium` 확인 후 제한 해제 + 개인화 순위 추가. |
| **F-08** | 데이터 내보내기 | `emotion_records`, `emotion_record_emotions`, `emotion_record_activities`, `report_cache` | `POST /functions/v1/export-pdf`, `POST /functions/v1/export-csv` | 구독 확인 → 데이터 집계 → 파일 생성 → Storage 업로드 → 서명된 URL 반환. |
| **F-09** | 인앱 결제 | `subscriptions`, `users` | `POST /functions/v1/verify-subscription`, `POST /functions/v1/webhook/revenuecat` | 클라이언트: RevenueCat SDK. 서버: Webhook으로 구독 이벤트 수신 → DB 업데이트. |

### 7-8. 자체 점검 결과

| 점검 항목 | 결과 | 상세 |
|----------|------|------|
| P0 기능별 DB 테이블·API 매핑 존재 | **통과** | F-01~F-09 모두 매핑표에 대응하는 테이블과 엔드포인트 존재 |
| FK 관계 ↔ 데이터 흐름 일치 | **통과** | `emotion_records` → `emotion_record_emotions`/`activities` M:N 관계, `selfcare_emotion_map` → `emotions`/`selfcare_cards` 양방향 참조, `selfcare_feedback` → `emotion_records` 선택적 FK 등 모든 기능 간 데이터 흐름에 대응하는 FK 존재 |
| API → 수용 기준 충족 가능성 | **통과** | AC-01-1(1초 응답): RPC 트랜잭션 + 오프라인 우선 설계로 충족. AC-03-2(무료 3개): `daily_card_usage` + Edge Function 로직으로 충족. AC-06-1(프리미엄 전용): Edge Function 내 구독 검증으로 충족. AC-09-1(즉시 반영): RevenueCat Webhook + `users.is_premium` 업데이트로 충족 |

---

## 8. Competitive Differentiation

### 8-1. 포지셔닝

```
"하루콩처럼 간편하게 기록하고, 무디처럼 행동을 제안받되,
 AI가 나만의 감정 패턴을 발견해주는 앱"
```

### 8-2. 핵심 차별화 3요소

| 차별점 | 설명 | 경쟁사 대비 |
|--------|------|-----------|
| **한국어 감정 어휘 체계** | '서운하다', '답답하다', '억울하다' 등 36종 한국어 고유 감정 어휘 분류 | 하루콩/데일리오: 범용 5단계, 무디: 일부 반영 |
| **감정 패턴 분석** | 감정-활동-시간 상관관계를 SQL 통계로 자동 분석 | 하루콩: 기초 통계, 무디: 규칙 기반, 데일리오: 통계만 |
| **셀프케어 행동 제안 + 효과 추적** | 감정별 행동 카드 제안 + 피드백 기반 개인화 | 무디: 퀘스트(규칙 기반), 하루콩/데일리오: 없음 |

*근거: 2단계 경쟁분석 — "AI 기반 감정 패턴 분석 + 개인화된 셀프케어 행동 제안"을 통합 제공하는 앱은 현재 시장에 부재*

### 8-3. 라일리 하루 대비 차별화

라일리 하루(2024.12 출시)가 가장 유사한 직접 경쟁자:

| 영역 | 라일리 하루 | 마음날씨 |
|------|-----------|---------|
| AI 접근 | 자체 LLM 멀티모달 분석 (기술 중심) | SQL 통계 기반 패턴 분석 (실용 중심) |
| 감정 입력 | AI가 텍스트/사진/음성에서 감정 추출 | 사용자가 직접 한국어 감정 어휘 선택 |
| 핵심 가치 | "AI가 내 감정을 분석해준다" | "내 감정 패턴을 알고, 행동으로 관리한다" |
| 행동 제안 | 없음 (분석 중심) | 핵심 기능 (셀프케어 카드) |
| 기술 비용 | 높음 (자체 LLM 운영) | 낮음 (SQL 집계, 외부 AI 불필요) |

---

## 9. Monetization Strategy

### 9-1. 구독 플랜

| 항목 | 무료 | 프리미엄 (월 3,500원 / 연 27,900원) |
|------|------|--------------------------------------|
| 일일 감정 기록 | 무제한 | 무제한 |
| 감정 캘린더 | O | O |
| 기본 주간 요약 | O (텍스트 요약만) | O |
| 셀프케어 카드 | 3개/일 | 무제한 |
| AI 상세 패턴 리포트 | X | O (주간/월간) |
| 감정-활동 상관관계 인사이트 | X | O |
| 개인화된 셀프케어 순위 | X | O |
| PDF 내보내기 | X | O |
| 공유 카드 | 기본 디자인 | 프리미엄 디자인 |
| 광고 | 없음 | 없음 |

### 9-2. 가격 전략 근거

| 비교 대상 | 가격 | 마음날씨 대비 |
|----------|------|-------------|
| 하루콩 프리미엄 | ~5,000원 (일회성) | 유사 가격대 |
| 마보 프리미엄 | 3,300~3,900원/월 | 거의 동일 |
| 루빗 프리미엄 | ~53,000원/년 | 마음날씨가 더 저렴 |
| 전문 상담 1회 | 3~10만원 | 마음날씨 1/10~1/30 가격 |

*근거: 2단계 시장분석 — 건강&피트니스 앱 연간 구독 중앙값 $29.65, 무료체험→유료 전환율 44.5% (RevenueCat 2025)*

### 9-3. 수익 전망

| 시나리오 | MAU | 유료 전환율 | 유료 사용자 | 월 매출 | 연 매출 |
|---------|-----|-----------|-----------|--------|--------|
| 보수적 (1년차) | 5만 | 3% | 1,500 | 525만 원 | 6,300만 원 |
| 중간 (2년차) | 15만 | 4% | 6,000 | 2,100만 원 | 2.5억 원 |
| 낙관적 (3년차) | 50만 | 5% | 25,000 | 8,750만 원 | 10.5억 원 |

### 9-4. 수익 모델 강화 방안 (향후)

| 방안 | 설명 | 시기 |
|------|------|------|
| 캐릭터/테마 판매 | 날씨 캐릭터 테마 일회성 구매 | MVP+3개월 |
| 감정 유형 분석 | MBTI처럼 "나의 감정 유형" → 무료 바이럴 + 심화 분석 유료 | MVP+2개월 |
| 기업 B2B (장기) | 사내 직원 감정 관리 대시보드 | MVP+12개월 |

---

## 10. Risk Matrix

### 10-1. 사업 리스크

| 리스크 | 심각도 | 발생 가능성 | 대응 방안 |
|--------|--------|-----------|----------|
| 하루콩의 AI 기능 추가 | 높음 | 중간 | 글로벌 전략 우선 → 한국어 특화 집중 가능성 낮음. 데이터 축적 기반 개인화로 차별화 |
| 블루시그넘 생태계 완성 | 높음 | 중간 | 하루콩+무디+라임AI 통합 시 위협. 1인 개발의 민첩성 + 한국어 감정 체계 깊이로 대응 |
| 유료 전환 실패 | 높음 | 중간~높음 | 7일 무료 체험 + 무료→유료 가치 격차 명확화 + 캐릭터/테마 판매 보조 수익 |
| 감정 기록 피로감 | 중간 | 높음 | 10초 기록 + 푸시 리마인더 + 셀프케어 카드의 즉각적 가치 제공 |

### 10-2. 기술 리스크

| 리스크 | 심각도 | 발생 가능성 | 대응 방안 |
|--------|--------|-----------|----------|
| Supabase 서비스 장애 | 중간 | 낮음 | 오프라인 우선 설계로 로컬 저장 보장. Supabase 99.9% SLA |
| RevenueCat 정책 변경 | 낮음 | 낮음 | 대안 (Adapty, Qonversion) 존재 |
| React Native 성능 한계 | 낮음 | 낮음 | 감정 기록 앱은 CPU 집약적 작업 없음 |
| 앱스토어 심사 거절 | 낮음 | 낮음 | "셀프케어" 포지셔닝, 건강 주장 배제 |

### 10-3. 법률/규제 리스크

| 리스크 | 심각도 | 발생 가능성 | 대응 방안 |
|--------|--------|-----------|----------|
| 개인정보보호법 | 중간 | 확실 | 처리방침 고지, 최소 수집, 삭제 요청 대응, RLS 격리 |
| 의료기기 규제 | 높음 | 낮음 | "셀프케어" 앱 포지셔닝, 진단/치료 주장 배제, 면책 고지 |
| 앱스토어 IAP 수수료 | 중간 | 확실 | 15~30% 수수료 감안한 가격, 소규모 개발자 프로그램 (15%) 적용 |

### 10-4. 의존성 리스크

| 의존 대상 | 위험 시나리오 | 대응 |
|----------|-------------|------|
| Supabase | 가격 인상, 서비스 종료 | 표준 PostgreSQL → 자체 호스팅 전환 가능 |
| RevenueCat | 가격 인상 | Adapty, Qonversion 대안 |
| Expo | 버전 호환 이슈 | EAS Build로 네이티브 빌드 분리 가능 |
| 카카오 로그인 API | 정책 변경 | Apple 로그인 + 이메일 인증 병행 |

---

## 11. Assumptions & Constraints

### 11-1. 사업적 가정

| 가정 | 검증 방법 |
|------|----------|
| MZ세대는 감정을 "관리 대상"으로 인식한다 | 필코노미/메타센싱 트렌드 데이터, 출시 후 사용자 인터뷰 |
| 한국어 감정 어휘 특화가 차별점이 된다 | 하루콩 이탈 사용자 대상 A/B 테스트 |
| 월 3,500원이 심리적 허들을 넘을 수 있다 | 7일 무료 체험 전환율로 검증 |
| "기록→분석→행동" 루프가 기록만보다 리텐션이 높다 | D7/D30 리텐션 비교 |
| 규칙 기반 셀프케어 추천만으로 MVP 가치가 충분하다 | "도움됨" 피드백 비율 60%+ 목표 |

### 11-2. 외부 의존성

| 의존 대상 | 영향 범위 | 대안 |
|----------|----------|------|
| Supabase (BaaS) | 전체 백엔드 | 자체 PostgreSQL + Node.js (마이그레이션 가능) |
| RevenueCat | 인앱 결제 | Adapty, Qonversion |
| Expo Push | 푸시 알림 | Firebase Cloud Messaging (FCM) 직접 연동 |
| 앱스토어/플레이스토어 | 배포 및 결제 | 대안 없음 (필수 의존) |

### 11-3. 기술 제약

| 제약 | 영향 |
|------|------|
| React Native + TypeScript만 사용 | 네이티브 전용 기능 접근 시 Expo 모듈 필요 |
| Supabase Free Tier 한계 | 동시 접속 200, DB 500MB, Edge Function 500K 호출/월 → Pro 전환 시점 계획 필요 |
| 1인 개발 | 기능 범위 제한, 디자인/마케팅 리소스 한정 |
| 3개월 MVP 기한 | P0 기능에만 집중, P1/P2는 MVP 이후 |

---

## 12. Out of Scope

### MVP에서 명시적으로 제외하는 기능·영역

| 제외 항목 | 사유 | 예상 도입 시기 |
|----------|------|--------------|
| LLM 기반 개인화 인사이트 | 외부 AI API 비용 + 복잡도 → SQL 통계로 MVP 충분 | MVP+2개월 |
| 멀티모달 입력 (사진, 음성) | 개발 복잡도 높음, 텍스트/태그 기반으로 충분 | MVP+6개월 |
| 감정 유형 분석 | 데이터 축적 필요 (최소 3개월) | MVP+2개월 |
| 홈 화면 위젯 | P1 기능, MVP 핵심이 아님 | MVP+1개월 |
| 예측적 알림 | 데이터 축적 + 패턴 모델 필요 | MVP+3개월 |
| 전문 상담 연결 | 외부 파트너십 필요 | MVP+6개월 |
| B2B 대시보드 | 사업 모델 확장, MVP 범위 외 | MVP+12개월 |
| 캐릭터/테마 상점 | 디자인 리소스 필요 | MVP+3개월 |
| 소셜 기능 (친구, 커뮤니티) | MVP는 개인 사용 중심 | 미정 |
| 다국어 지원 | 한국 시장 집중 | MVP+12개월 |

---

## 13. MVP Roadmap

### 13-1. 3개월 마일스톤

| 주차 | 마일스톤 | 핵심 산출물 |
|------|---------|-----------|
| **W1~W2** | 프로젝트 셋업 & 기초 UI | Expo 프로젝트 초기화, Supabase 설정, DB 마이그레이션, 디자인 시스템, 네비게이션 구조, WatermelonDB 설정 |
| **W3~W4** | 인증 & 감정 기록 | 카카오/Apple/이메일 로그인, 온보딩, 감정 기록 화면, 감정 어휘 데이터, 오프라인 저장/동기화 |
| **W5~W6** | 캘린더 & 기본 통계 | 감정 캘린더, 기록 히스토리, 주간 요약 (무료) |
| **W7~W8** | 셀프케어 카드 & 패턴 리포트 | 셀프케어 카드 추천, 피드백 수집, 상세 패턴 리포트 (유료), 리포트 캐싱 |
| **W9~W10** | 결제 & 프리미엄 기능 | RevenueCat 연동, 구독 관리, PDF/CSV 내보내기, 앱 잠금 |
| **W11~W12** | QA & 출시 준비 | 버그 수정, 성능 최적화, 앱스토어 심사 제출, 랜딩 페이지 |

### 13-2. MVP 이후 로드맵

| 시기 | 기능 | 목적 |
|------|------|------|
| MVP+1개월 | 홈 화면 위젯 | 접근성 향상, 기록 빈도 증가 |
| MVP+2개월 | 감정 유형 분석 + 공유 카드 | 바이럴 성장 |
| MVP+2개월 | LLM 인사이트 문구 | 유료 기능 가치 강화 |
| MVP+3개월 | 예측적 알림 | "내일 월요일 스트레스 주의" 등 |
| MVP+3개월 | 캐릭터/테마 상점 | 추가 수익원 |
| MVP+6개월 | 상담 연결 | 심각 케이스 대응 |
| MVP+12개월 | 기업 B2B 대시보드 | 수익 다각화 |

---

## 14. Success Metrics

### 14-1. 핵심 지표 (출시 6개월)

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| **MAU** | 30,000명 | PostHog / Supabase |
| **DAU/MAU 비율** | 30%+ | 감정 기록 앱 특성상 일일 사용 핵심 |
| **유료 전환율** | 3%+ | RevenueCat |
| **D7 리텐션** | 40%+ | PostHog (건강 앱 평균 20~30%) |
| **D30 리텐션** | 20%+ | PostHog |
| **주 3회+ 기록 비율** | 50%+ | 활성 사용자 중 |
| **NPS** | 40+ | 인앱 설문 |

### 14-2. 비즈니스 지표 (출시 12개월)

| 지표 | 목표 | 비고 |
|------|------|------|
| **MRR** | 525만 원+ | 유료 1,500명 × 3,500원 |
| **무료체험 → 유료 전환** | 30%+ | 건강&피트니스 중위 44.5% 대비 보수적 |
| **월간 구독 갱신율** | 60%+ | 건강&피트니스 중위 58~67% |
| **앱스토어 평점** | 4.5+ | 경쟁사 평균 수준 |

### 14-3. 제품 지표

| 지표 | 목표 | 의미 |
|------|------|------|
| **평균 기록 시간** | 15초 이내 | 10초 목표, 메모 포함 시 15초 |
| **일인당 일평균 기록 수** | 1.5회 | 최소 1회/일 |
| **셀프케어 카드 "도움됨" 비율** | 60%+ | 추천 정확도 |
| **주간 리포트 확인율** | 70%+ (유료) | 유료 기능 활용도 |
| **공유 카드 생성율** | 10%+ (MAU 대비) | 바이럴 기여 |

---

## 부록 A: 한국어 감정 어휘 체계 (36종)

### 대분류 (7종)

| ID | 대분류 | 날씨 | 색상 | 감정가 |
|----|--------|------|------|--------|
| 1 | 기쁨 | 맑음 | #FFD700 | 긍정 |
| 2 | 기대/설렘 | 무지개 | #FF6B9D | 긍정 |
| 3 | 평온 | 구름 한 점 없는 하늘 | #87CEEB | 중립 |
| 4 | 슬픔 | 비 | #6B89C4 | 부정 |
| 5 | 분노 | 번개 | #FF4444 | 부정 |
| 6 | 불안 | 흐림 | #9E9E9E | 부정 |
| 7 | 무기력 | 안개 | #B0BEC5 | 부정 |

### 소분류 (36종)

| 대분류 | 소분류 감정 어휘 |
|--------|----------------|
| **기쁨** | 기쁨, 행복, 뿌듯함, 감사함, 재미있음 |
| **기대/설렘** | 설렘, 기대됨, 두근거림, 신남, 흥분 |
| **평온** | 편안함, 여유로움, 만족, 잔잔함, 무난함 |
| **슬픔** | 슬픔, 서운함, 섭섭함, 외로움, 그리움, 허전함 |
| **분노** | 화남, 짜증남, 답답함, 억울함, 분함 |
| **불안** | 불안함, 걱정됨, 초조함, 긴장됨, 눈치 보임 |
| **무기력** | 무기력, 지침, 귀찮음, 멍함, 공허함, 번아웃 |

## 부록 B: 셀프케어 행동 카드 분류 (초안)

### 카테고리 (5종)

| 카테고리 | 설명 | 예시 |
|---------|------|------|
| **호흡/명상** (breathing) | 호흡법, 짧은 명상, 마음챙김 | 4-7-8 호흡법, 3분 마음챙김 |
| **움직임** (movement) | 가벼운 신체 활동 | 스트레칭, 산책, 계단 오르기 |
| **감각** (sensory) | 감각을 통한 이완 | 따뜻한 차, 좋아하는 음악, 향초 |
| **사회적** (social) | 사람과의 연결 | 친구에게 메시지, 가족 통화 |
| **창의적** (creative) | 표현을 통한 감정 처리 | 일기 쓰기, 그림 그리기, 요리 |

### 감정-행동 매핑 원칙

| 감정 대분류 | 추천 카테고리 우선순위 | 근거 |
|-----------|---------------------|------|
| 기쁨 | 사회적 > 창의적 > 감각 | 긍정 감정 공유/확장 |
| 기대/설렘 | 움직임 > 창의적 > 감각 | 에너지 활용 |
| 평온 | 감각 > 창의적 > 호흡/명상 | 평온 유지/심화 |
| 슬픔 | 감각 > 사회적 > 호흡/명상 | 위로/연결 |
| 분노 | 움직임 > 호흡/명상 > 창의적 | 에너지 발산/진정 |
| 불안 | 호흡/명상 > 감각 > 움직임 | 안정/이완 |
| 무기력 | 움직임 > 감각 > 사회적 | 활성화/자극 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-01-30 | 초안 작성 | Claude |
| 2.0 | 2026-01-31 | 3단계 PRD 구조(14개 섹션) 정비, `sc:design` 기반 기술 아키텍처 보강 (오프라인 우선 설계, WatermelonDB/MMKV 계층, push_tokens·daily_card_usage·report_cache 테이블 추가, 기능-테이블-API 매핑표, 자체 점검), Assumptions & Constraints·Out of Scope 섹션 신규 | Claude |
